#+TITLE: Palindromic Products Benchmarking
#+AUTHOR: Peter Farr

* Overview
This project compares different implementations of the "palindromic products"
coding challenge, originally from Exercism (https://exercism.org).

** The problem
Given a range of integers [min, max], find:
- the smallest palindromic product of two factors in that range
- the largest palindromic product of two factors in that range

A palindromic product is a product whose decimal representation is a palindrome.

Each function returns:
1. The palindrome value itself
2. The list of factor pairs that generate it

** The goal
We implement and benchmark solutions in both Common Lisp (SBCL) and Rust.
The objective is to measure performance trade-offs across languages and
algorithmic optimizations.

* Project layout
- =lisp/= Common Lisp implementations and build scripts
- =rust-palindrome/= Rust solution binaries and library
- =palindrome-benchmark/= Criterion harness that drives all binaries
- =target-bin/= where all compiled executables are collected

* Build all binaries (Lisp then Rust)

** Common Lisp (SBCL)
From the =lisp/= directory, run each build script with SBCL like this:

#+BEGIN_SRC shell
cd lisp

sbcl --dynamic-space-size 4096 --noinform --disable-debugger --non-interactive \
     --load build-fast-smallest-inner.lisp

sbcl --dynamic-space-size 4096 --noinform --disable-debugger --non-interactive \
     --load build-fast-largest-inner.lisp

sbcl --dynamic-space-size 4096 --noinform --disable-debugger --non-interactive \
     --load build-comm-smallest-inner.lisp

sbcl --dynamic-space-size 4096 --noinform --disable-debugger --non-interactive \
     --load build-comm-largest-inner.lisp
#+END_SRC

Each command produces an executable in =target-bin/=:
- palprod-fast-smallest-inner
- palprod-fast-largest-inner
- palprod-comm-smallest-inner
- palprod-comm-largest-inner

** Rust
Build the Rust solution in release mode, then copy the binaries to =target-bin/=:

#+BEGIN_SRC shell
cd rust-palindrome
RUSTFLAGS="-C target-cpu=native" cargo build --release

cp target/release/palprod-rust-smallest ../target-bin/
cp target/release/palprod-rust-largest  ../target-bin/
#+END_SRC

After these steps, =target-bin/= should contain six executables:
- palprod-fast-smallest-inner
- palprod-fast-largest-inner
- palprod-comm-smallest-inner
- palprod-comm-largest-inner
- palprod-rust-smallest
- palprod-rust-largest

* Benchmark harness design

To ensure fair comparisons, we benchmark by shelling out to fully compiled
executables. This avoids bias from interpreter startup or compilation latency.

Criterion (in =palindrome-benchmark/=) runs each binary via a small harness that
acts like a "server": it performs warmups, then repeated timed runs. By
amortizing the process startup cost, the measurements reflect only the algorithm
runtime, not external overhead. This design makes cross-language benchmarking
much more reliable.

* Run the Criterion suite

The Criterion project expects all executables to already be present in =target-bin/=.

#+BEGIN_SRC shell
cd palindrome-benchmark
RUSTFLAGS="-C target-cpu=native" cargo bench
#+END_SRC

Criterion will run the configured scenarios and report timing distributions and
comparisons.

* Current results

Latest average times per iteration:

| Implementation |    Range | Task     | Time      |
|----------------+----------+----------+-----------|
| Rust           | 100..999 | largest  | 5.9766 µs |
| Rust           | 910..999 | smallest | 1.8526 µs |
| fast (Lisp)    | 100..999 | largest  | 7.5308 µs |
| fast (Lisp)    | 910..999 | smallest | 2.2396 µs |
| comm (Lisp)    | 100..999 | largest  | 6.6962 ms |
| comm (Lisp)    | 910..999 | smallest | 2.2065 ms |

* Notes
- Both languages use a numeric half-reversal palindrome check (no strings).
- The Common Lisp code adds type declarations to encourage fixnum arithmetic in SBCL.
- We apply pruning (outer and inner) and early exits (for example divisibility by 11 on even-digit products) to reduce calls to the palindrome predicate.

* Attribution
Problem statement: Exercism, Common Lisp track, Palindrome Products
https://exercism.org/tracks/common-lisp/exercises/palindrome-products

This repository extends the original exercise with performance-focused
implementations and cross-language benchmarks.
